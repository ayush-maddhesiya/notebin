import test = require("blue-tape");
import { getTestClient } from "./test";
import { B2Asset } from "./asset";

async function getAsset() {
  return new B2Asset(await getTestClient());
}

test("B2File.listAll", async function(t) {
  const a = await getAsset();
  const files = await a.list("/test");
  t.assert(Array.isArray(files), "works");
  t.assert(files.some(f => f.name === "hello.txt"));
});

test("B2File.delete", async function(t) {
  const a = await getAsset();
  await a.upload("/test", [
    {
      filename: "test_delete.txt",
      content: Buffer.from("test_delete")
    }
  ]);

  let files = await a.list("/test");
  t.assert(files.some(f => f.name === "test_delete.txt"));

  await a.delete("/test/test_delete.txt");

  files = await a.list("/test");
  t.assert(files.every(f => f.name !== "test_delete.txt"));
});

test("B2File.upload", async function(t) {
  const a = await getAsset();
  const urls = await a.upload("/test", [
    {
      filename: "upload_test_1.txt",
      content: Buffer.from("test_1")
    }
  ]);

  t.assert(Array.isArray(urls), "works");

  const files = await a.list("/test");
  t.assert(files.some(f => f.name === "upload_test_1.txt"));

  await a.delete("/test/upload_test_1.txt");
});
